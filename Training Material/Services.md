## Network Services
#### FTP

>[!code]- Connect to FTP server
>```bash
>ftp $ip
>```

>[!code]- Download all files
>- **-m** to mirror the directory and follow links recursively
>- **--no-passive** disables passive mode
>```bash
>wget -m ftp://anonymous:anonymous@10.10.10.98
>wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98
>```

>[!code]- Brute force usernames/passwords
>
#### DNS

>[!info]- Info - The different DNS records
>- **NS:** Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain
>- **A:** (aka host records) contain the IPv4 address of a hostname (eg www.example.com)
>- **AAAA:** (aka quad A host records) contain the IPv6 address of a hostname (eg www.example.com)
>- **MX:** Mail Exchange records contain the names of the servers responsible for handling email for the domain
>- **PTR:** Pointer Records are used in reverse lookup zones and can find the records associated with an IP address
>- **CNAME:** Canonical Name Records are used to create aliases for other host records
>- **TXT:** Text records can contain any arbitrary data

>[!code]- Find DNS records associated with a domain
>Find the IP address (A record) of a domain:
>```bash
>www.megacorpone.com has address 149.56.244.87
>```
>___
>
>Find other records (eg mx records) of a domain:
>```bash
>kali@kali:~$ host -t mx megacorpone.com
>kali@kali:~$ host -t txt megacorpone.com
>```

>[!code]- See if a particular server exists
>```bash
>kali@kali:~$ host idontexist.megacorpone.com
>```

>[!code]- Specify which DNS server to query
>Query the 192.168.50.151 DNS server for any TXT record related to the info.megacorptwo.com host:
>```bash
>C:\Users\student>nslookup -type=TXT info.megacorptwo.com 192.168.50.151
>```

>[!code]- Find hostnames by brute forcing DNS lookups
>Create a list of possible hostnames:
>```bash
>kali@kali:~$ cat list.txt www  
ftp  
mail
owa
proxy
router
>```
>___
>
>DNS lookup each hostname in the list:
>```bash
>kali@kali:~$ for ip in $(cat list.txt); do host $ip.megacorpone.com; done
>www.megacorpone.com has address 149.56.244.87  
>Host ftp.megacorpone.com not found: 3(NXDOMAIN)  
>mail.megacorpone.com has address 51.222.169.212
>Host owa.megacorpone.com not found: 3(NXDOMAIN)
>Host proxy.megacorpone.com not found: 3(NXDOMAIN)
>router.megacorpone.com has address 51.222.169.214
>```
>___
>
>More comprehensive wordlists are available in the **seclists** directory.

>[!code]- Automate DNS Enumeration with DNSRecon and DNSenum
>DNSRecon:
>- **-d** option to specify a domain name
>- **-t** option to specify the type of enumeration to perform (eg. standard)
>```bash
>kali@kali:~$ dnsrecon -d megacorpone.com -t std
>```
>- **-D** to specify a file name (_list.txt_) containing potential subdomain strings
>- **-t** to specify the type of enumeration to perform (eg brute force)
>```bash
>kali@kali:~$ dnsrecon -d megacorpone.com -D ~/list.txt -t brt
>```
>___
>
>DNSEnum:
>```bash
>kali@kali:~$ dnsenum megacorpone.com
>```
#### SMB

>[!info]- Port 139 (NetBIOS) vs Port 445 (SMB)
>The NetBIOS service listens on TCP port 139, as well as several UP ports. This is a different service to SMB (TCP port 445). NetBIOS allows computers on a local network to communicate with each other. NetBIOS over TCP is required for backwards compatibility alongside SMB.

>[!code]- Nmap SMB enumeration
>Script location:
>```bash
>kali@kali:~$ ls -1 /usr/share/nmap/scripts/smb*
>```
>Using a script in a scan:
>```bash
>kali@kali:~$ nmap -v -p 139,445 --script smb-os-discovery 192.168.50.152
>```
>
>___
>
>Discovering hosts running an SMB server:
>```bash
>kali@kali:~$ nmap -v -p 139,445 -oG smb.txt 192.168.50.1-254
>```

>[!code]- nbtscan to find NetBIOS names
>This can reveal NetBIOS names:
>```bash
>kali@kali:~$ sudo nbtscan -r 192.168.50.0/24
>```

>[!code]- List SMB shares
>Using Windows:
>```powershell
>C:\Users\student>net view \\dc01 /all
>```
>Using Linux:
>```bash
>smbclient -N -L //192.168.63.205
>smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //192.168.50.205
>```

>[!code]- Connect to a share
>###### smbclient
>```powershell
># Anonymous
>smbclient -N //192.168.24.168/share/
># Authenticated
>smbclient -U 'username' //192.168.24.168/share/
>```

>[!code]- Recursively list or download share files
>###### List
>```powershell
>smbclient -N //10.10.10.100/sharename -c 'recurse;ls'
>```
>###### Download
>```powershell
>smbclient -N //10.10.10.100/Replication
>mask ""
>recurse ON
>Prompt OFF
>mget *
>```
#### SMTP

>[!info]- Info - The Simple Mail Transport Protocol (SMTP) is a mail server for delivering emails

>[!code]- Enumerate valid users
>The following example shows how the server will confirm or deny whether a particular user exists:
>```bash
>kali@kali:~$ nc -nv 192.168.50.8 25
>(UNKNOWN) [192.168.50.8] 25 (smtp) open
>220 mail ESMTP Postfix (Ubuntu)  
>VRFY root  
>252 2.0.0 root  
>VRFY idontexist
550 5.1.1 \<idontexist\>: Recipient address rejected: User unknown in local recipient table  
>^C
>```
>___
>A Python script which opens a TCP socket, connects to the SMTP server, and issues a VRFY command for a given username.
>>[!code]- smtp.py
>>```python
>>#!/usr/bin/python
>>
>>import socket import sys
>>
>>if len(sys.argv) != 3:  
>>print("Usage: vrfy.py \<username> <target_ip>") sys.exit(0)
>>
>># Create a Socket  
>>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
>>
>># Connect to the Server  
>>ip = sys.argv[2]  
>>connect = s.connect((ip,25))
>>
>># Receive the banner banner = s.recv(1024)
>>
>>print(banner)
>>
>># VRFY a user  
>>user = (sys.argv[1]).encode() s.send(b'VRFY ' + user + b'\r\n') result = s.recv(1024)
>>
>>print(result)
>>
>># Close the socket s.close()
>>```
>
>We can run the script by providing the username to be test as the first argument and the target IP as the second argument:
>```bash
>kali@kali:~/Desktop$ python3 smtp.py root 192.168.50.8
>```

>[!code]- See whether a SMTP server is running using a Windows machine
>Test whether an SMTP server is running:
>```powershell
>PS C:\Users\student> Test-NetConnection -Port 25 192.168.50.8
>```
>___
>Interact with the SMTP server:
>
>**(Requires admin privileges)** - we can interact with the SMTP server from the Windows machine we can use the Microsoft version of the Telnet client:
>```powershell
>PS C:\Windows\system32> dism /online /Enable-Feature /FeatureName:TelnetClient
>```
>**(Doesn't require admin privileges)** - run the telnet binary (might need to transfer it first):
>```powershell
>c:\windows\system32\telnet.exe
>C:\Windows\system32>telnet 192.168.50.8 25
>``` 
#### SNMP

>[!info]- Commonly used SNMP tree branches
>![Pasted image 20240602094105](../Images/Pasted%20image%2020240602094105.png)

>[!code]- Enumerate the SNMP port
>With Nmap:
>```bash
>kali@kali:~$ sudo nmap -sU --open -p 161 192.168.50.1-254 -oG open-snmp.txt
>```

>[!code]- Brute force the community string (password)
>First we must build a text file containing the community strings to brute force (_community_) and another one containing the IP addresses to scan:
>```bash
>kali@kali:~$ echo public > community
>kali@kali:~$ echo private >> community
>kali@kali:~$ echo manager >> community
>
>kali@kali:~$ for ip in $(seq 1 254); do echo 192.168.50.$ip; done > ips
>
>kali@kali:~$ onesixtyone -c community -i ips
>```

>[!code]- Enumerate the SNMP tree
>Using **snmpwalk**, enumerate the entire MIB tree:
>- **-c** to specify the community string
>- **-v** to specify the SNMP version number
>- **-t 10** to increase the timeout period to 10 seconds
>```bash
>kali@kali:~$ snmpwalk -c public -v1 -t 10 192.168.50.151
>```
>Eg., enumerate all currently running process:
>```bash
>kali@kali:~$ snmpwalk -c public -v1 192.168.50.151 1.3.6.1.2.1.25.4.2.1.2
>```
>
>___
>
>Using **snmp-check**, enumerate the tree and obtain key information:
>```bash
>kali@kali:~$ snmp-check 192.168.221.42
>```
#### LDAP

>[!code]- Get domain name
>
>```powershell
>ldapsearch -H ldap://10.10.10.175:389/ -x -s base namingcontexts
>```

>[!code]- List all available objects
>```powershell
>ldapsearch -x -H ldap://10.10.10.169 -D '' -w '' -b "DC=megabank,DC=local"
>```
#### RPC

>[!code]- Connect
>```powershell
>rpcclient -U "" -N 10.10.10.169
>```

>[!code]- Show user object descriptions
>```powershell
>querydispinfo
>```
#### SSH

>[!code] Brute force password
>###### Hydra
>
## Web Services

#### Wordpress

>[!code]- Enumerate plugins
>###### WPScan
>```powershell
># All plugins (ap)
>wpscan scan --url http://10.10.110.100:65000/wordpress/ -e ap
>
># Vulnerable plugins (vp)
>wpscan scan --url http://10.10.110.100:65000/wordpress/ -e vp
>```

>[!code]- Enumerate users
>###### WPScan
>```powershell
>wpscan --url http://10.10.110.100:65000/wordpress/ -e u 
>```

>[!code]- Enumerate themes
>###### WPScan
>```powershell
># All themes
>wpscan scan --url http://10.10.110.100:65000/wordpress/ -e at
>
># Vulnerable themes
>wpscan scan --url http://10.10.110.100:65000/wordpress/ -e vt
>```
#### General

>[!code]- Brute force http-post login
>###### Hydra
>```powershell
>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form "/department/login.php:username=admin&password=^PASS^:Invalid Password!"
>```

>[!code]- Create a wordlist from website
>###### CeWL
>- Defaults to a depth of `2`
>- `-d 5` changes depth to 5
>```powershell
>cewl http://10.10.110.100:65000/wordpress/
>```

