## Passive Information Gathering

#### Whois

>[!info]- Info - What is Whois?
>Whois is a TCP service, tool, and type of database that can provide information about a domain name, such as the _name server_ and _registrar_. This information is often public, since registrars charge a fee for private registration.

>[!code]- Gather information about a domain name or IP address with WHOIS
>- **-h** is the IP address of our WHOIS server
>```bash
>kali@kali:~$ whois megacorpone.com -h 192.168.50.251
>```
>
>___
>
>Perform a reverse lookup on an IP address:
>```bash
>kali@kali:~$ whois 38.100.193.70 -h 192.168.50.251
>```
#### Google Dorks

>[!code]- Find directory listings for a site with `intitle`
>Search `intitle: "index of" "parent directory"` to find pages that contain "index of" in the title and the words "parent directory" on the page.

>[!code]- Other Google Dorks
>[See here](https://www.exploit-db.com/google-hacking-database)
#### Netcraft

>[!info]- Info - [Netcraft](https://www.netcraft.com/) lists services associated with a particular IP or domain
#### Open Source Code Repositories

>[!code]- Search the victims Github repos for information
>Search for `filename:users` to search for any files with the word "users" in the name.

>[!code]- Automate searching Github repos with [Gitrob](https://github.com/michenriksen/gitrob) or [Gitleaks](https://github.com/zricethezav/gitleaks)
#### Shodan

>[!info]- Info - [Shodan](https://www.shodan.io/) searches for internet-connected devices (eg. IoT, routers)
#### Security Headers

>[!info]- Info - [Security Headers](https://securityheaders.com/) analyses HTTP response headers to provide analysis
## Active Information Gathering

#### Host Enumeration

>[!code]- Use Nmap to perform a network sweep
>Nmap will send an ICMP echo request, a TCP SYN packet to port 443, a TCP ACK packet to port 80, and an ICMP timestamp request. 
>- **-sn** option to perform a network sweep
>```bash
>kali@kali:~$ nmap -sn 192.168.50.1-253
>```
>___
>Scan top ports for each discovered host:
>```bash
>kali@kali:~$ nmap -sT -A --top-ports=20 192.168.50.1-253 -oG top-port-sweep.txt
>```
#### Hostname Enumeration

>[!code]- Find hostnames by brute forcing DNS lookups
>Create a list of possible hostnames:
>```bash
>kali@kali:~$ cat list.txt www  
ftp  
mail
owa
proxy
router
>```
>___
>
>DNS lookup each hostname in the list:
>```bash
>kali@kali:~$ for ip in $(cat list.txt); do host $ip.megacorpone.com; done
>www.megacorpone.com has address 149.56.244.87  
>Host ftp.megacorpone.com not found: 3(NXDOMAIN)  
>mail.megacorpone.com has address 51.222.169.212
>Host owa.megacorpone.com not found: 3(NXDOMAIN)
>Host proxy.megacorpone.com not found: 3(NXDOMAIN)
>router.megacorpone.com has address 51.222.169.214
>```
>___
>
>More comprehensive wordlists are available in the **seclists** directory.

>[!code]- Find hostnames by brute forcing reverse IP lookups
>- Only show results that do not contain "not found"
>```bash
>kali@kali:~$ for ip in $(seq 200 254); do host 51.222.169.$ip; done | grep -v "not found"
>```
#### Port Enumeration

>[!code]- Netcat TCP and UDP port scan
>TCP port scan:
>- **-w** option to specify the connection timeout in seconds
>- **-z** to specify zero-I/O mode, which is used for scanning and sends no data
>```bash
>kali@kali:~$ nc -nvv -w 1 -z 192.168.50.152 3388-3390
>```
>___
>UDP port scan:
>- **-u** option indicates a UDP scan
>```bash
>kali@kali:~$ nc -nv -u -z -w 1 192.168.50.149 120-123
>```

>[!code]- Nmap TCP and UDP port scan
>TCP scan:
>```bash
>kali@kali:~$ sudo nmap -sS 192.168.50.149    # quicker
>kali@kali:~$ nmap -sT 192.168.50.149
>```
>UDP scan:
>```bash
>kali@kali:~$ sudo nmap -sU 192.168.50.149
>```
>UDP and TCP scan:
>```bash
>kali@kali:~$ sudo nmap -sU -sS 192.168.50.149
>```

>[!code]- Nmap service scan on ports
>- **-A** specifies to inspect service banners and runs various OS and service enumeration scripts
>- **-sV** would run the scan with only the service enumeration option
>```bash
>kali@kali:~$ nmap -sT -A 192.168.50.14
>kali@kali:~$ sudo nmap -sS -A 192.168.50.14
>```

>[!code]- Nmap scripts
>The Nmap scripts are located in the **/usr/share/nmap/scripts** directory.
>```bash
>kali@kali:~$ nmap --script http-headers 192.168.50.6
>```

>[!code]- PowerShell port scan
>Port scan for an SMB server:
>```powershell
>PS C:\Users\student> Test-NetConnection -Port 445 192.168.50.151
>```
>Port scan first 1024 ports (ignore the backslash):
>```powershell
>PS C:\Users\student> 1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect("192.168.50.151", $\_)) "TCP port $_ is open"} 2>$null
>```
#### FTP Enumeration

>[!code]- Connect to FTP server
>```bash
>ftp $ip
>```

>[!code]- Download all files
>- **-m** to mirror the directory and follow links recursively
>- **--no-passive** disables passive mode
>```bash
>wget -m ftp://anonymous:anonymous@10.10.10.98
>wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98
>```
#### DNS Enumeration

>[!info]- Info - The different DNS records
>- **NS:** Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain
>- **A:** (aka host records) contain the IPv4 address of a hostname (eg www.example.com)
>- **AAAA:** (aka quad A host records) contain the IPv6 address of a hostname (eg www.example.com)
>- **MX:** Mail Exchange records contain the names of the servers responsible for handling email for the domain
>- **PTR:** Pointer Records are used in reverse lookup zones and can find the records associated with an IP address
>- **CNAME:** Canonical Name Records are used to create aliases for other host records
>- **TXT:** Text records can contain any arbitrary data

>[!code]- Find DNS records associated with a domain
>Find the IP address (A record) of a domain:
>```bash
>www.megacorpone.com has address 149.56.244.87
>```
>___
>
>Find other records (eg mx records) of a domain:
>```bash
>kali@kali:~$ host -t mx megacorpone.com
>kali@kali:~$ host -t txt megacorpone.com
>```

>[!code]- See if a particular server exists
>```bash
>kali@kali:~$ host idontexist.megacorpone.com
>```

>[!code]- Specify which DNS server to query
>Query the 192.168.50.151 DNS server for any TXT record related to the info.megacorptwo.com host:
>```bash
>C:\Users\student>nslookup -type=TXT info.megacorptwo.com 192.168.50.151
>```

>[!code]- Find hostnames by brute forcing DNS lookups
>Create a list of possible hostnames:
>```bash
>kali@kali:~$ cat list.txt www  
ftp  
mail
owa
proxy
router
>```
>___
>
>DNS lookup each hostname in the list:
>```bash
>kali@kali:~$ for ip in $(cat list.txt); do host $ip.megacorpone.com; done
>www.megacorpone.com has address 149.56.244.87  
>Host ftp.megacorpone.com not found: 3(NXDOMAIN)  
>mail.megacorpone.com has address 51.222.169.212
>Host owa.megacorpone.com not found: 3(NXDOMAIN)
>Host proxy.megacorpone.com not found: 3(NXDOMAIN)
>router.megacorpone.com has address 51.222.169.214
>```
>___
>
>More comprehensive wordlists are available in the **seclists** directory.

>[!code]- Automate DNS Enumeration with DNSRecon and DNSenum
>DNSRecon:
>- **-d** option to specify a domain name
>- **-t** option to specify the type of enumeration to perform (eg. standard)
>```bash
>kali@kali:~$ dnsrecon -d megacorpone.com -t std
>```
>- **-D** to specify a file name (_list.txt_) containing potential subdomain strings
>- **-t** to specify the type of enumeration to perform (eg brute force)
>```bash
>kali@kali:~$ dnsrecon -d megacorpone.com -D ~/list.txt -t brt
>```
>___
>
>DNSEnum:
>```bash
>kali@kali:~$ dnsenum megacorpone.com
>```
#### SMB Enumeration

>[!info]- Port 139 (NetBIOS) vs Port 445 (SMB)
>The NetBIOS service listens on TCP port 139, as well as several UP ports. This is a different service to SMB (TCP port 445). NetBIOS allows computers on a local network to communicate with each other. NetBIOS over TCP is required for backwards compatibility alongside SMB.

>[!code]- Nmap SMB enumeration
>Script location:
>```bash
>kali@kali:~$ ls -1 /usr/share/nmap/scripts/smb*
>```
>Using a script in a scan:
>```bash
>kali@kali:~$ nmap -v -p 139,445 --script smb-os-discovery 192.168.50.152
>```
>
>___
>
>Discovering hosts running an SMB server:
>```bash
>kali@kali:~$ nmap -v -p 139,445 -oG smb.txt 192.168.50.1-254
>```

>[!code]- nbtscan to find NetBIOS names
>This can reveal NetBIOS names:
>```bash
>kali@kali:~$ sudo nbtscan -r 192.168.50.0/24
>```

>[!code]- List SMB shares
>Using Windows:
>```powershell
>C:\Users\student>net view \\dc01 /all
>```
>Using Linux:
>```bash
>smbclient -N -L //192.168.63.205
>smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //192.168.50.205
>```

>[!code]- Connect to a share
>Linux:
>```bash
>smbclient -N //192.168.24.168/share-name/
>```
#### SMTP Enumeration

>[!info]- Info - The Simple Mail Transport Protocol (SMTP) is a mail server for delivering emails

>[!code]- Enumerate valid users
>The following example shows how the server will confirm or deny whether a particular user exists:
>```bash
>kali@kali:~$ nc -nv 192.168.50.8 25
>(UNKNOWN) [192.168.50.8] 25 (smtp) open
>220 mail ESMTP Postfix (Ubuntu)  
>VRFY root  
>252 2.0.0 root  
>VRFY idontexist
550 5.1.1 \<idontexist\>: Recipient address rejected: User unknown in local recipient table  
>^C
>```
>___
>A Python script which opens a TCP socket, connects to the SMTP server, and issues a VRFY command for a given username.
>>[!code]- smtp.py
>>```python
>>#!/usr/bin/python
>>
>>import socket import sys
>>
>>if len(sys.argv) != 3:  
>>print("Usage: vrfy.py \<username> <target_ip>") sys.exit(0)
>>
>># Create a Socket  
>>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
>>
>># Connect to the Server  
>>ip = sys.argv[2]  
>>connect = s.connect((ip,25))
>>
>># Receive the banner banner = s.recv(1024)
>>
>>print(banner)
>>
>># VRFY a user  
>>user = (sys.argv[1]).encode() s.send(b'VRFY ' + user + b'\r\n') result = s.recv(1024)
>>
>>print(result)
>>
>># Close the socket s.close()
>>```
>
>We can run the script by providing the username to be test as the first argument and the target IP as the second argument:
>```bash
>kali@kali:~/Desktop$ python3 smtp.py root 192.168.50.8
>```

>[!code]- See whether a SMTP server is running using a Windows machine
>Test whether an SMTP server is running:
>```powershell
>PS C:\Users\student> Test-NetConnection -Port 25 192.168.50.8
>```
>___
>Interact with the SMTP server:
>
>**(Requires admin privileges)** - we can interact with the SMTP server from the Windows machine we can use the Microsoft version of the Telnet client:
>```powershell
>PS C:\Windows\system32> dism /online /Enable-Feature /FeatureName:TelnetClient
>```
>**(Doesn't require admin privileges)** - run the telnet binary (might need to transfer it first):
>```powershell
>c:\windows\system32\telnet.exe
>C:\Windows\system32>telnet 192.168.50.8 25
>``` 
#### SNMP Enumeration

>[!info]- Commonly used SNMP tree branches
>![Pasted image 20240602094105](../Images/Pasted%20image%2020240602094105.png)

>[!code]- Enumerate the SNMP port
>With Nmap:
>```bash
>kali@kali:~$ sudo nmap -sU --open -p 161 192.168.50.1-254 -oG open-snmp.txt
>```

>[!code]- Brute force the community string (password)
>First we must build a text file containing the community strings to brute force (_community_) and another one containing the IP addresses to scan:
>```bash
>kali@kali:~$ echo public > community
>kali@kali:~$ echo private >> community
>kali@kali:~$ echo manager >> community
>
>kali@kali:~$ for ip in $(seq 1 254); do echo 192.168.50.$ip; done > ips
>
>kali@kali:~$ onesixtyone -c community -i ips
>```

>[!code]- Enumerate the SNMP tree
>Using **snmpwalk**, enumerate the entire MIB tree:
>- **-c** to specify the community string
>- **-v** to specify the SNMP version number
>- **-t 10** to increase the timeout period to 10 seconds
>```bash
>kali@kali:~$ snmpwalk -c public -v1 -t 10 192.168.50.151
>```
>Eg., enumerate all currently running process:
>```bash
>kali@kali:~$ snmpwalk -c public -v1 192.168.50.151 1.3.6.1.2.1.25.4.2.1.2
>```
>
>___
>
>Using **snmp-check**, enumerate the tree and obtain key information:
>```bash
>kali@kali:~$ snmp-check 192.168.221.42
>```